This is the code for https://lunarwatcher.github.io/posts/2022/12/25/lua-5.4-tables-and-arrays-in-the-c-api.html -- if you're looking for explanations, that's where you should be.
